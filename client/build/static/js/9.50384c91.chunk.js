(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[9],{446:function(e,t,s){},447:function(e,t,s){},478:function(e,t,s){},487:function(e,t,s){"use strict";s.r(t),s.d(t,"default",(function(){return g}));var i=s(4),n=s(0),c=s(23),a=s(12),r=s(15),o=s.n(r),d=s(36),u=s(7),l=s(147),v=s(66),j=s.n(v),m=(s(446),s(43)),h=s(90),p=(s(447),s(483)),b=s(250),f=s(448);function O(e){var t=e.partner,s=Object(n.useState)(""),r=Object(m.a)(s,2),v=r[0],O=r[1],_=Object(n.useState)([]),x=Object(m.a)(_,2),g=x[0],N=x[1],y=Object(n.useState)(null),k=Object(m.a)(y,2),S=k[0],w=k[1],U=Object(c.useSelector)((function(e){return e.chats})).chats,I=Object(n.useRef)(),D=Object(n.useRef)(),E=Object(c.useDispatch)(),C=Object(a.h)().partnerId,H=Object(f.io)("http://localhost:3000");Object(n.useEffect)((function(){D.current.scrollIntoView({behavior:"smooth"}),H.on("messageFromServer",(function(e){console.log(e),H.emit("dataToServer",{data:"Data from the Client!"})}))}),[]),H.on("sendMsg",(function(e){console.log("msg received from server",e),E({type:u.l,payload:e})})),Object(n.useEffect)((function(){var e=null===U||void 0===U?void 0:U.filter((function(e){var t,s;return(null===(t=e.chatUsers[0])||void 0===t?void 0:t._id)===C||(null===(s=e.chatUsers[1])||void 0===s?void 0:s._id)===C}))[0];w(null===e||void 0===e?void 0:e._id),N(null===e||void 0===e?void 0:e.messages)}),[U,null===t||void 0===t?void 0:t._id,E,C]),Object(n.useEffect)((function(){D.current.scrollIntoView({behavior:"smooth"})}),[g]),Object(n.useEffect)((function(){}),[S]);return Object(i.jsxs)("div",{className:"discussion",children:[Object(i.jsxs)("div",{className:"discussion__header",children:[Object(i.jsx)("img",{src:(null===t||void 0===t?void 0:t.image.startsWith("http"))?"".concat(null===t||void 0===t?void 0:t.image):"https://make-it-happen-demo.herokuapp.com/".concat(null===t||void 0===t?void 0:t.image),alt:"",className:"discussion__img"}),Object(i.jsx)("div",{className:"discussion__header-info",children:Object(i.jsx)("p",{className:"discussion__header-user",children:(null===t||void 0===t?void 0:t.firstName)+" "+(null===t||void 0===t?void 0:t.lastName)})})]}),Object(i.jsxs)("div",{className:"discussion__body",children:[null===g||void 0===g?void 0:g.map((function(e){return Object(i.jsxs)("div",{className:"discussion__msg "+((null===e||void 0===e?void 0:e.userId)!==t._id?"sent":" "),children:[Object(i.jsx)("p",{className:"discussion__msg-text",children:e.text}),Object(i.jsx)("p",{className:"discussion__msg-time",children:Object(p.a)(Object(b.a)(e.timeStamp),"HH:mm")})]},e._id)})),Object(i.jsx)("div",{ref:D})]}),Object(i.jsx)("div",{children:Object(i.jsxs)("form",{onSubmit:function(e){e.preventDefault();var s,i={text:v,partnerId:t._id,timestamp:Date.now()};E((s=i,function(){var e=Object(d.a)(o.a.mark((function e(t){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:u.k}),e.next=4,j.a.post("/api/msg/add",s,Object(l.a)());case 4:e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),t({type:u.j,payload:e.t0});case 9:case"end":return e.stop()}}),e,null,[[0,6]])})));return function(t){return e.apply(this,arguments)}}())),O(""),I.current.focus()},className:"discussion__footer",children:[Object(i.jsx)("input",{type:"text",value:v,onChange:function(e){return O(e.target.value)},placeholder:"Type a message",className:"discussion__input",ref:I}),Object(i.jsxs)("button",{className:"btnSend",children:[Object(i.jsx)(h.a,{name:"send"}),"Send"]})]})})]})}s(478);function _(){var e=Object(c.useSelector)((function(e){return e.chats})).chats,t=Object(c.useSelector)((function(e){return e.auth})).profile,s=Object(a.g)(),n=function(e){if((null===e||void 0===e?void 0:e.messages[e.messages.length-1].userId)===(null===t||void 0===t?void 0:t._id))return"You : "};return Object(i.jsxs)("div",{className:"sidebar",children:[Object(i.jsx)("h2",{children:"Discussions"}),e.map((function(e){var c,a,r;return Object(i.jsxs)("div",{className:"sidebar__discussion",onClick:function(){return s.push("/chat/".concat(x(e.chatUsers,t._id)._id))},children:[Object(i.jsx)("img",{src:(null===(c=x(null===e||void 0===e?void 0:e.chatUsers,null===t||void 0===t?void 0:t._id))||void 0===c?void 0:c.image.startsWith("http"))?"".concat(null===(a=x(null===e||void 0===e?void 0:e.chatUsers,null===t||void 0===t?void 0:t._id))||void 0===a?void 0:a.image):"https://make-it-happen-demo.herokuapp.com/".concat(null===(r=x(e.chatUsers,null===t||void 0===t?void 0:t._id))||void 0===r?void 0:r.image),alt:"",className:"sidebar__discussion-img"}),Object(i.jsxs)("div",{className:"sidebar__msg",children:[Object(i.jsx)("p",{className:"sidebar__name",children:x(null===e||void 0===e?void 0:e.chatUsers,t._id).firstName+"  "+x(null===e||void 0===e?void 0:e.chatUsers,t._id).lastName}),Object(i.jsxs)("p",{children:[n(e),null===e||void 0===e?void 0:e.messages[e.messages.length-1].text]})]})]},e._id)}))]})}var x=function(e,t){return e.filter((function(e){return e._id!==t}))[0]};function g(){var e=Object(c.useSelector)((function(e){return e.goal})).partners,t=Object(a.h)().partnerId,s=Object(c.useDispatch)();return Object(n.useEffect)((function(){s(function(){var e=Object(d.a)(o.a.mark((function e(t){var s,i;return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t({type:u.k}),e.next=4,j.a.get("/api/msg/",Object(l.a)());case 4:s=e.sent,i=s.data,t({type:u.m,payload:i}),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),t({type:u.j,payload:e.t0});case 12:case"end":return e.stop()}}),e,null,[[0,9]])})));return function(t){return e.apply(this,arguments)}}())}),[s]),Object(i.jsxs)("div",{className:"chat",children:[Object(i.jsx)(_,{}),Object(i.jsx)(O,{partner:null===e||void 0===e?void 0:e.filter((function(e){return e._id===t}))[0]})]})}}}]);
//# sourceMappingURL=9.50384c91.chunk.js.map